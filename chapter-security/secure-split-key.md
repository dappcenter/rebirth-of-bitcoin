# 安全拆分密钥技术

比特币继续令人们趋之若鹜，但人们也依然对钱包里和交易所中的比特币的安全性心存疑虑。近来随着据称在过去 6 年利用价值 40 亿美元的比特币疯狂洗钱的 BTC-e 所有者 Alexander Vinnik 被捕，当年的 MtGox 幽灵黑客再次引发轰动，上述安全问题也再次成为人们关注的焦点。此人落网后让人们开始怀疑，他或其他相关人员是否要对 MtGox 热钱包私钥和 85 万比特币的失窃承担责任。为了比特币的进一步发展，需要增强消费者和虚拟货币业务经营者的信心，让他们相信私钥不会被窃取。

nChain 相信利用自己的两项正在申请专利的安全发明，可以解决这一问题：（1）确定性密钥生成技术；（2）安全拆分密钥技术。这两种技术可以用来保护数字钱包，避免再次出现类似于 Mt. Gox 事件的黑客攻击。但是这些发明能做的远不止这些；它们可以保护任何数字化数据、资产、通信或受控资源，而且随着我们的世界和设备变得日益数字化，它们的潜在用途会越来越多。

自成立以来，nChain 公司一直致力于各种各样支持区块链发展的研究和发明。现在公司很高兴把详细的工作成果分享出来 ——首先是上述两项发明，它们不仅可以防止私钥面临的安全问题，从更广泛的角度来看，还可以增强任何关键和敏感数据的数字化存储的信心。

## 发明 1: 确定性密钥生成

第一项技术包含于一个正在申请的名为“确定一个用于安全的信息交换和分层确定性密钥的公共秘密”的专利。我们更简单地称其为“确定性密钥生成技术”。完整描述参见 PCT 申请，编号：[PCT/IB2017/050856.](https://nchain.com/app/uploads/2017/08/Deterministic-Key-Generation-PCT-Application-as-filed.pdf)

从本质上来说，该技术改进了网络上一对节点或交易双方之间的安全通信。概括来说：

* 网络上的一对节点（即交易双方），各自拥有私钥和公钥，交换各自的公钥，同时保留私钥的秘密。
* 他们还交换了一条信息。
* 然后他们彼此之间达成一个基于该信息的确定性密钥。该密钥是“确定的”，因为多次执行密钥生成算法均将生成与之相同的密钥。
* 然后每个节点确定：
  * 自己私钥的更新版本，基于其现有私钥和确定性密钥；
  * 其他节点公钥的更新版本，基于其他节点的现有公钥和确定性密钥。

这可以通过对现有私钥和确定性密钥进行简洁的数学推导处理而实现。

然后，每一对节点根据其自己更新的私钥和其他节点的更新公钥来确定一个公共（即共享）的秘密。由于确定性密钥基于共享信息，因此属于两个节点共有，相同的公共秘密可由两个节点确定，但需要借助不同的更新私钥和更新公钥的组合。那么该公共秘密可用作保护节点之间通信的基础。

### 发明的优势和用例

该技术可以在不需要存储公共秘密的情况下实现双方之间的安全通信，因为公共秘密可以按照需要由各方基于共享信息单独确定。重要的是，该信息无需按照与私钥相同的安全级别进行存储，甚至在某些情况下可能是公开的。

另一个重要的优势在于，利用该技术还可以生成 **多个** 基于每个节点单一主私钥且对应于多个安全私钥的公共秘密。通过基于双方预先商定的流程确定一系列连续的确定性密钥，可以具体做到这一点。因此，尽管各方只需安全地存储单一的私钥，但这些多个私钥依然可以保持安全。这不仅减轻了庞大的安全负担，还可使用户生成源自基差或主钥的分层密钥。根据用户意愿，它可以生成各层密钥具有逻辑关联的“子钥”。例如，虚拟货币业务运营商可以生成代表和保护相关账户或与特定组织或个人有关的实体的密钥。因此，确定性密钥可以安全生成，并以这种方式反映出它们所使用的环境或背景。

该技术的应用多种多样，甚至不局限于比特币或区块链环境中的使用。随着数字化世界中日益增长的数字资产、数据云存储、创新数字通信模式以及物联网设备的预期爆发，这项技术的潜在用例可谓不计其数。基本上，该创新成果可以为 **任何** 需要保护敏感数据、资产、通信或受控资源的环境提供重要的安全优势。各种具体实施包括：

* 公开显示不会被重新使用的比特币地址；
* 确保商家 PoS 销售系统的安全；
* 安全传送信息；
* 确保文件安全归档；
* 保护智能预言机；
* 安全控制物联网设备。

为了说明该技术是如何建立起来以提供进一步创新的，以下是一个关于该技术如何被用于保护 **数字钱包**（对于比特币或任何其他数字资产）的示例。公钥 / 私钥对经常用于数字钱包。但是，如果钱包用户负责存储他们的私钥，则当私钥、用户本身或他们的硬件无法使用时，可能会出现问题，因为这会导致钱包内的资金无法使用。 相反，私钥存储在钱包提供者终端，则需要对服务提供者及其安全机制具有一定程度的信任。如果服务提供者的系统被黑客攻击，若干私钥就会落入未经授权的人员手中。然后资金就可能被窃取或破坏。因此，私钥必须以一种既能确保不被未经授权方获得，又能在必要时进行复制的方式存储。

## 发明2: 安全拆分密钥技术

为了解决上面提到的问题，nChain 推出了另一项发明——安全拆分密钥技术：如何以一种既能确保不被未经授权方获得，又能在必要时复制的方式存储私钥（例如用于数字钱包）。基于确定性密钥生成技术创建，第二项发明名为“结合钱包管理系统阻止区块链系统密钥存储和转移中的多方损失”，完整描述参见 PCT 申请，编号：[PCT/IB2017/050829.](https://nchain.com/app/uploads/2017/08/Secure-Split-Key-PCT-Application-as-filed.pdf)

概括来说，nChain 的安全拆分密钥发明可以通过以下方式保护数字钱包或其他类型的资源：

将密钥（或用于密钥的助记种子）拆分成多个份额，并且可以从两个或以上的份额中恢复或重新生成。这可以使用一种称为 “沙米尔秘密分享方案（4S）” 的加密算法来执行，该算法将密钥拆分成不同的部分或份额，然后分发给不同的各方。 这些份额可用于在必要时重建密钥。每个个体份额本身都毫无价值或用途，除非与一个或多个其他份额结合在一起。重建密钥所需的份额数量根据情况需求而有所变化。在某些情况下，可能需要所有份额，而在其他情况下，可能只需满足一定数量即可。

* 在网络（即交易双方）的两个或多个节点上确定一个公共秘密，然后使用公共秘密生成一个可用于加密一个或多个份额或有关份额信息的密钥。
* 利用公共秘密在两个或多个节点之间传输至少一个密钥份额。这两个步骤可以利用前面提到的技术以及上述确定性密钥生成发明来执行。双方之间的份额传输必须以一种安全的方式进行，因为任何未经授权截获多个份额都可以使截获者重建密钥。

因此，密钥或其助记的不同份额务必在各方之间安全传输，然后存储在单独的位置。 密钥不会以完整形式存储于任何地方，直至需要的时候，届时它可以从指定数量的份额中重新生成——即借助当初用于拆分它的 4S 算法。任何一方都不能单方面复原私钥，甚至连用户本身也不行。即使用户去世、丧失行为能力或丢失自己的密钥，另外的合法一方——律师或近亲也可以利用其他两个份额获得资金 *。* 或者，即使钱包提供商被黑客攻击，密钥以及资金依然保持安全。

所以，例如，数字钱包提供商可以按照如下的 “2/3” 方案（即重新生成密钥的阈值是两个份额）使用该技术：

* 用户通过钱包提供商注册，创建新的钱包来存储其资金或其他数字资产（如比特币）。
* 生成一个公钥 / 私钥对，并关联至用户的钱包。
* 私钥通过 4S 拆分成多个份额。
* 利用上述技术发明将私钥的一个份额安全传输给用户。
* 私钥的另一个份额由钱包提供商保留，并存储在服务器上。
* 另一个份额通过安全传输发送至远程位置进行安全存储。
* 钱包提供商可以销毁已经不再需要的完整私钥的任何或全部副本。当为了获得用户后续授权而需要私钥时（例如，由于用户现在希望进行交易），则利用用户提供给钱包提供商的份额，再加上钱包提供商自身保留的份额，可以重建密钥。
* 即使丢失了一个份额，依然可以利用剩余的两个份额重建密钥。

因此，nChain 创建的解决方案可以保护数字钱包（实际上包括任何其他类型的受控资源），从而避免因自行存储私钥或信任第三方（例如钱包提供商）而引发的风险。利用该技术（结合确定性密钥生成技术），再也不会发生类似 MtGox 的黑客攻击；黑客将无法获取用户的完整密钥，也就无法窃取他们的比特币或其他资产。

这两项正在申请专利的发明——确定性密钥生成和安全拆分密钥技术——将促使更多消费者和服务供应商相信比特币以及更广泛的所有数字资产、通信和受控资源的安全性。这仅仅是 nChain 在其开发技术解决方案以实现区块链指数级增长的使命之旅中，将要完成的多项激动人心的发明的开端。

nChain 的上述两项发明的 PCT 专利申请信息如下：

* 确定性密钥生成技术 （“确定一个用于安全的信息交换和分层确定性密钥的公共秘密”）- [PCT/IB2017/050856](https://nchain.com/app/uploads/2017/08/Deterministic-Key-Generation-PCT-Application-as-filed.pdf))

“安全拆分密钥”技术（“结合钱包管理系统阻止区块链系统密钥存储和转移中的多方损失”）- [PCT/IB2017/050829](https://nchain.com/app/uploads/2017/08/Secure-Split-Key-PCT-Application-as-filed.pdf))
